# Blueprint Home Assistant MiButton Remote

## Описание
Управление светом в Home Assistant с помощью беспроводной кнопки Xiaomi Mi Wireless Switch (YTC4040GL) и датчика двери / движения.
Система включает и выключает свет по кнопке, датчику и таймеру, а также наблюдает за остаточным временем.

### Управление кнопкой:

одиночное нажатие: включает свет на короткое время / выключает
двойное нажатие: включает свет на среднее время или увеличивает яркость на 100%, если свет уже включен
тройное нажатие: включает свет на долгое время
четырехкратное нажатие: включает / уменьшает свет до 1% на 1 минуту
многократное: настраиваемое
удержание: добавляет / убавляет яркость

### Управление по датчикам
#### Сбработка по датчику открытия / движения (sensor detect 1,2):
свет выключен: включает свет на короткое время
время таймера ниже time detect (в минутах) тогда сработавший датчик перезапускает таймер на короткое время
(пример: time detect=3 мин., на таймере 2 минуты, перезапустит таймер на время Short)

#### АВТО Включение света , когда 1 и 2 бинарные сенсоры в состоянии /on/, а 3 бинарный сенсор /off/
(пример: удобно использовать бинарные TOD - это время суток - день/ночь, обнатный сенсор нужен для корретной работы датчиков освещенности (Светло = off).
Если первые два дали on, а третий off, то свет будет включаться по первому датчику (движения, открытия ...) 

#### Выключение света по времени отсутствия движения / открытия time Inactivity (No motion)
(пример: Датички не фиксируют движения и находятся в состоянии off - в Х минутах - выключаем свет.

## Требования
Создать таймер
Обеспечить 2 бинарными сенсорами detect 1 и 2 (движения, открытия)
Обеспечить 3 бинарными сенсорами tod 1, 2, off

## Пример автоматизации
    automation:
        alias: Свет. Управление светом в гостинной
        description: Управление светом в гостинной
        use_blueprint:
          path: MrSnake/Light Remote MiButton.yaml
          input:
            light_1: light.child_lights
            switch: sensor.mi_button_3_action
            button: binary_sensor.soff_t1_guest_touch_1
            detect_1: binary_sensor.motion_detect_1_occupancy
            detect_2: binary_sensor.motion_detect_2_occupancy
            boolean_start: true
            time_detect: 5
            tod1: binary_sensor.tod_day
            tod2: binary_sensor.tod_day
            todoff: binary_sensor.lumi_night_day
            boolean_off: true
            time_no_motion: 5
            timer: timer.svet_childroom
            time_short: "00:10:00"
            time_medium: "00:20:00"
            time_long: "01:00:00"

